<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container">
      <form action="">
        <div class="row">
          <div class="col-4 mt-4">
            <label>Pavadinimas:</label>
            <input
              type="text"
              id="search"
              class="form-control"
            />
          </div>
          <div class="col-4 mt-4">
            <label for="brand">Brandas:</label>
            <input type="text" id="brandFilter" name="brand" class="form-control" />
          </div>
            <div class="col-4 mt-4">
              <label for="brand">Kategorija:</label>
              <select name="category" id="categoryFilter" class="form-control">
                <option>Smartphones</option>
                <option>Laptops</option>
                <option>Fragrances</option>
                <option>Skin care</option>
                <option>Groceries</option>
                <option>Home-decoration</option>
              </select>
            </div>
            <div class="col-4 mt-4">
              <label>Kaina nuo:</label>
              <input type="number" id="priceMin" class="form-control">
            </div>
            <div class="col-4 mt-4">
              <label>Kaina iki:</label>
              <input type="number" id="priceMax" class="form-control">
            </div>
        </div>
        <button class="btn btn-primary filter-btn mt-2">Submit</button>
      </form>
      <table class="table table-striped mt-5">
        <thead>
          <tr>
            <th>#</th>
            <th>Title</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Brand</th>
            <th>Category</th>
          </tr>
        </thead>
        <tbody id="filtered"></tbody>
      </table>
    </div>
    <div class="container">
      <form action="">
        <div class="row">
          <div class="col-4 mt-4">
            <label for="title">Pavadinimas:</label>
            <input type="text" id="title" name="title" class="form-control" />
          </div>
          <div class="col-4 mt-4">
            <label for="price">Kaina:</label>
            <input type="text" id="price" name="price" class="form-control" />
          </div>
          <div class="col-4 mt-4">
            <label for="stock">Sandėlyje:</label>
            <input type="text" id="stock" name="stock" class="form-control" />
          </div>
          <div class="col-4 mt-4">
            <label for="brand">Brandas:</label>
            <input type="text" id="brand" name="brand" class="form-control" />
          </div>
          <div class="col-4 mt-4">
            <label for="brand">Kategorija:</label>
            <select name="category" id="category" class="form-control">
              <option>Smartphones</option>
              <option>Laptops</option>
              <option>Fragrances</option>
              <option>Skin care</option>
              <option>Groceries</option>
              <option>Home-decoration</option>
            </select>
          </div>
          <div class="col-4 mt-4">
            <button class="btn btn-primary mt-4" id="submit">Submit</button>
          </div>
        </div>
      </form>
      <table class="table table-striped mt-5">
        <thead>
          <tr>
            <th>#</th>
            <th>Title</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Brand</th>
            <th>Category</th>
            <th>Delete</th>
            <th>Update</th>
          </tr>
        </thead>
        <tbody id="dynamicData"></tbody>
      </table>
    </div>
    <script src="script.js"></script>
    <script>
      //CRUD:
      //Create - Sukurti įrašą
      //Read - Peržiūrėti įrašą
      //UPDATE - Atnaujinti įrašą
      //DELETE - Ištrinti įrašą

      let currentProduct = undefined;
      let editMode = false;
      const dynamicDataElement = document.getElementById("dynamicData"),
        titleInputElement = document.getElementById("title"),
        priceInputElement = document.getElementById("price"),
        stockInputElement = document.getElementById("stock"),
        brandInputElement = document.getElementById("brand"),
        categoryInputElement = document.getElementById("category"),
        submitButtonElement = document.getElementById("submit");
      //Arrow function doesnt work when it's above the function, while function .. () does
      // Automatinis funkcijos iskvietimas apskliaudus funkcija ir uz jos padejus skliaustelius
      const generateTableContents = () => {
        let dynamicHTML = ``;
        for (const product of products) {
          dynamicHTML += `<tr>
                <td>${product.id}</td>
                <td>${product.title}</td>
                <td>${product.price}</td>
                <td>${product.stock}</td>
                <td>${product.brand}</td>
                <td>${product.category}</td>
                <td><button class="btn btn-danger" onclick="deleteProduct(${product.id})">Remove</button></td>
                <td><button class="btn btn-success" onclick="setEdit(${product.id})">Update</button></td>
                </tr>`;
        }
        dynamicDataElement.innerHTML = dynamicHTML;
      };

      generateTableContents();

      const createNewRecord = (event) => {
        event.preventDefault();
        const newProduct = {
          id: products[products.length - 1].id + 1,
          title: titleInputElement.value,
          price: priceInputElement.value,
          stock: stockInputElement.value,
          brand: brandInputElement.value,
          category: categoryInputElement.value,
        };
        products.push(newProduct);

        generateTableContents();
      };

      submitButtonElement.onclick = createNewRecord;

      const deleteProduct = (id) => {
        let elementIndex = products.findIndex((value) => value.id === id);
        products.splice(elementIndex, 1);
        generateTableContents();
      };

      const updateProduct = (event) => {
        event.preventDefault();
        products[currentProduct].title = titleInputElement.value;
        products[currentProduct].price = priceInputElement.value;
        products[currentProduct].stock = stockInputElement.value;
        products[currentProduct].brand = brandInputElement.value;
        products[currentProduct].category = categoryInputElement.value;

        generateTableContents();
        currentProduct = undefined;
        editMode = false;
        submitButtonElement.onclick = createNewRecord;
        submitButtonElement.innerText = "Submit";
        submitButtonElement.classList.add("btn-primary");
        submitButtonElement.classList.remove("btn-success");
        titleInputElement.value = "";
        priceInputElement.value = "";
        stockInputElement.value = "";
        brandInputElement.value = "";
        categoryInputElement.value = "";
      };

      const setEdit = (id) => {
        let elementIndex = products.findIndex((value) => value.id === id);
        const product = products[elementIndex];
        titleInputElement.value = product.title;
        priceInputElement.value = product.price;
        stockInputElement.value = product.stock;
        brandInputElement.value = product.brand;
        categoryInputElement.value = product.category;

        submitButtonElement.innerText = "Update";
        submitButtonElement.classList.add("btn-success");
        submitButtonElement.classList.remove("btn-primary");
        submitButtonElement.onclick = updateProduct;

        currentProduct = elementIndex;
        editMode = true;
      };

      const filter = document.querySelector(".filter-btn");
      const filterInput = document.querySelector("#search");
      const filteredTable = document.querySelector("#filtered");
      const categoryFilter = document.querySelector("#categoryFilter")
      const brandFilter = document.querySelector("#brandFilter")
      const priceMin = document.querySelector('#priceMin')
      const priceMax = document.querySelector('#priceMax')

      const generateFilteredTableContents = (value) => {
        let dynamicHTML = ``;
        for (const product of value) {
          dynamicHTML += `<tr>
                <td>${product.id}</td>
                <td>${product.title}</td>
                <td>${product.price}</td>
                <td>${product.stock}</td>
                <td>${product.brand}</td>
                <td>${product.category}</td>
                </tr>`;
        }
        filteredTable.innerHTML = dynamicHTML;
      };

      const setFilter = (event) => {
        event.preventDefault();
        const filterValue = filterInput.value.toLowerCase();
        const filterCategory = categoryFilter.value.toLowerCase();
        const filterBrand = brandFilter.value.toLowerCase();
        const filterPriceMin = parseFloat(priceMin.value);
        const filterPriceMax = parseFloat(priceMax.value);

        const filteredProducts = products.filter((product) =>
          product.title.toLowerCase().includes(filterValue) &&
          product.brand.toLowerCase().includes(filterBrand) &&
          product.category.toLowerCase().includes(filterCategory) &&
          product.price >= filterPriceMin &&
          product.price <= filterPriceMax

      );
        generateFilteredTableContents(filteredProducts);
      };
      
      filter.onclick = setFilter;

    </script>
  </body>
</html>
